(function(root){function Libs(){this.libs={}}function FileCache(){this.caches={},this.clear=(()=>this.caches={}),this.setStr=function(e,t){null!=t?(null==this.caches[e]&&(this.caches[e]={}),this.caches[e].str=t):null!=this.caches[e]&&delete this.caches[e]},this.getStr=function(e,t){if(t=null==t,null!=this.caches[e]){var n=this.caches[e].str;return t&&this.setStr(e,void 0),n}console.warn("get cache, but can't find "+e)},this.getList=function(){return Object.keys(this.caches)}}function FileCache3rd(){this.data=new FileCache,this.getStr=function(e){return null==this.data.caches[e]&&(this.data.caches[e]={}),this.data.caches[e].str},this.setStr=function(e,t){null==this.data.caches[e]&&(this.data.caches[e]={}),this.data.caches[e].str=t},this.loadAsync=function(e){var t=Ijnjs.Libs.s.libs.$,n=getSrd("ijnjs"),s=e.filter(e=>"jquery"!=e.na).map(e=>{var s=/https?:\/\//i.test(e.url);return 0==s&&(e.url=n+e.url),new Promise(n=>{t.ajax({url:e.url,dataType:"text",complete:()=>{n()},success:t=>{this.data.caches[e.na]={str:t}}})})});return Promise.all(s)}}function Ijnjs(){this.name="Ijnjs"}function getJQueryAsync(){return new Promise((res,rej)=>{var r1=new XMLHttpRequest;r1.onerror=(e=>{rej(e)}),r1.onload=(a1=>{if(304==r1.status||r1.status>=200&&r1.status<300){var isAlreadyHave=null!=window.$;FileCache3rd.s.setStr("jquery",r1.responseText),noRequireJs(()=>{eval(FileCache3rd.s.getStr("jquery"))});var r2={};r2.$=window.$,0==isAlreadyHave&&(delete window.$,delete window.jQuery),res(r2)}else rej(new Error("status code "+r1.status+" "+r1.statusText))}),r1.open("get",thirdPartFileDescription[0].url,!0),r1.send()})}function processIjnjsFile(caches){for(var a1 of["Path/Path","SplitStringByRegex","assert","TestTime","rem2Px"]){function f1(){eval(caches.getStr(a1))}var tmp={};f1.call(tmp),(new MergeImports).main(Ijnjs,tmp)}}function releaseCacheFromIjnjsAsync(){return testThenDoAsync({cbTest:()=>null!=Ijnjs.Libs.s.libs.bootstrap,msg:"release ijnjs cache"}).then(()=>{FileCache3rd.s.data.clear(),delete Ijnjs.FileCache3rd})}function exportToRootAndDefine(){root.Ijnjs=Ijnjs;var e="function"==typeof define&&define.amd;e&&define("Ijnjs",[],function(){return Ijnjs})}function getSrd(e){function t(e){function t(e){var t=e.length;for(let n=t-1;n>=0;n--)if("/"==e[n])return e.substr(n+1)}var n=new RegExp(e+"(?:.min)?.js$","i");for(var s of document.scripts)if(null!=s.src){var r=t(s.src);if(null!=r&&n.test(r))return s.src}}var n=t(e),s=n.substring(0,n.lastIndexOf("/")+1),r=s.replace(location.origin,"");return r}function process3rdFile(){function addLodash(){var isExist=null!=window._;if(0==isExist){function aaa(){eval(FileCache3rd.s.getStr("lodash"))}aaa.call(window)}Libs.s.libs._=window._,0==isExist&&delete window._}function addBootstrapWhenReady(){var $=Libs.s.libs.$;$(()=>{noRequireJs(()=>{function aaa(){eval(FileCache3rd.s.getStr("bootstrap"))}$("<style>",{text:FileCache3rd.s.getStr("bootstrap-css")}).appendTo($("head")),aaa.call(window),Libs.s.libs.bootstrap=window.bootstrap})})}function addJQueryUiAndTouchNowAndCssWhenReady(){function aaa(){eval(FileCache3rd.s.getStr("jquery-ui")),eval(FileCache3rd.s.getStr("jquery-touch"))}var isExist=null!=window.jQuery,$=Libs.s.libs.$;0==isExist&&(window.jQuery=$),aaa.call(window),$(()=>{$("<style>",{text:FileCache3rd.s.getStr("jquery-ui-css")}).appendTo($("head"))}),0==isExist&&delete window.jQuery}function addLinqJs(){function aaa(){eval(FileCache3rd.s.getStr("linq"))}aaa.call(Libs.s.libs)}noRequireJs(()=>{addLinqJs(),addJQueryUiAndTouchNowAndCssWhenReady(),addBootstrapWhenReady(),addLodash()})}function noRequireJs(e){function t(){if(null!=window.define)for(var e of["define","requirejs","require"])s[e]=window[e],window[e]=void 0}function n(){if(null!=s.define)for(var e of["define","requirejs","require"])window[e]=s[e],delete s[e]}var s={};t(),e(),n()}function testThenDoAsync(e){function t(){null==e&&(e={cbTest:()=>null!=window.Ijnjs})}function n(){"function"==typeof e&&(cbTest=e,e={cbTest:cbTest,msg:cbTest.toString()})}if(t(),n(),"object"!=typeof e)throw new Error("call testThen Do, args already use {}");return new Promise((t,n)=>{e.cbDo=(()=>t()),e.cbErr=(e=>t(e)),testThenDo(e)})}function testThenDo(e){function t(){s()?o():(c+=1,c>a?(console.log("wait limit max count. "+a),i(new Error("wait limit max count."+a))):(console.log("wait "+r),setTimeout(()=>{l()},n)))}if("object"!=typeof e)throw new Error("call testThen Do, args already use {}");var n=null==e.ms?333:e.ms,s=null==e.cbTest?()=>!0:e.cbTest,r=null==e.msg?"":e.msg,i=null==e.cbErr?()=>{}:e.cbErr,o=null==e.cbDo?()=>{}:e.cbDo,a=null==e.cntMax?50:e.cntMax,c=0,l=t;try{t()}catch(e){i(e)}}function MergeImports(){this.main=function(beMerged,objImport){if(null==objImport.exports){var ks=Object.keys(objImport);this.assert(1==ks.length);var k=ks[0];if(null!=beMerged[k]){if(this.isObject(beMerged[k])){var newFn=eval("this.f = function "+k+" (){}"),ks3=Object.keys(beMerged[k]);for(var k3 of ks3)newFn[k3]=beMerged[k][k3];beMerged[k]=newFn}if(this.assert(this.isFunction(beMerged[k])),this.isObject(objImport[k]))this.mergeEachKey(beMerged[k],objImport[k]);else{if(!this.isFunction(objImport[k]))throw new Error("MergeImport 設計不良, 會覆蓋原有的資料 "+k);var constructor1=this.getInnerCode(beMerged[k]),constructor2=this.getInnerCode(objImport[k]),newFn=this.genereateNewClass(k,constructor1+"\r\n"+constructor2);this.mergeEachKey(newFn,beMerged[k]),this.mergeEachKey(newFn,objImport[k]);var ks4=Object.keys(newFn);for(var k4 of ks4){var o=newFn[k4];if(this.isObject(o)&&(o instanceof objImport[k]||o instanceof beMerged[k]))for(var k5 of(newFn[k4]=new newFn,Object.keys(o)))newFn[k4][k5]=o[k5]}beMerged[k]=newFn}}else beMerged[k]=objImport[k]}else{var ks=Object.keys(objImport.exports);for(var k of ks){var tmp2={};tmp2[k]=objImport.exports[k],this.main(beMerged,tmp2)}}},this.isObject=function(e){return/object/.test(typeof e)},this.isFunction=function(e){return/function/.test(typeof e)},this.genereateNewClass=function(nameOfClass,content){try{var newFn=eval("this.f = function "+nameOfClass+" (){\r\n"+content+"\r\n}");return newFn}catch{return console.error("name "+nameOfClass+"\r\n"+content),eval("this.f = function "+nameOfClass+" (){}")}},this.mergeEachKey=function(e,t){if(null!=t.prototype){var n=Object.keys(t.prototype);for(var s of n)null!=e.prototype[s]&&console.error("Merge Import 沒有處理 prototype 中，也已存在的值 "+s),e.prototype[s]=t.prototype[s]}var r=Object.keys(t);for(var i of r)if(null==e[i])e[i]=t[i];else{var o={};o[i]=t[i],this.main(e,o)}},this.getInnerCode=function(e){var t=e.toString(),n=t.indexOf("{"),s=t.lastIndexOf("}");return n==s-1?"":t.substring(n+1,s-1)},this.assert=function(e,t){if(t=null==t?"assert false":t,"function"==typeof e){if(0==e())throw new Error(t)}else if(0==e)throw new Error(t)}}function getCacheAsync(e,t,n){function s(e,t,n){function s(e){for(var t=e.length,n=t-1;n>=0;n--){if("/"==e[n])return;if("."==e[n])return e.substr(n)}}function r(e){var t=e.lastIndexOf(".");return e.substring(0,t)}var i=[],o=function(e,t){for(var n of e)if("string"==typeof n)i.push({na:t+n});else{var s=""==t?n.dir+"/":t+n.dir+"/";o(n.children,s)}};o(e,"");var a=getSrd(n);for(var c of i){var l=s(c.na);if(null==l)c.url=t?a+c.na+".min.js":a+c.na+".js";else if(t){var u=r(c.na);c.url=a+u+".min"+l}else c.url=a+c.na}return i}var r=Ijnjs.Libs.s.libs.$,i=s(e,t,n);return Promise.all(i.map(e=>new Promise((t,n)=>{r.ajax({url:e.url,dataType:"text",complete:()=>t(e),success:n=>{e.str=n,t(e)}})}))).then(e=>{var t=new Ijnjs.FileCache;for(var n of e)null!=n.str&&(t.caches[n.na]={str:n.str});return t})}window.testThenDo=testThenDo,window.testThenDoAsync=testThenDoAsync,window.getSrd=getSrd,window.MergeImports=MergeImports,window.getCacheAsync=getCacheAsync;var thirdPartFileDescription=[{na:"jquery",url:"https://code.jquery.com/jquery-3.6.0.min.js"},{na:"linq",url:"https://unpkg.com/linq@3.2.4/linq.min.js"},{na:"jquery-ui",url:"https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"},{na:"jquery-ui-css",url:"https://code.jquery.com/ui/1.12.1/themes/blitzer/jquery-ui.css"},{na:"jquery-touch",url:"../jquery.ui.touch-punch.min.js"},{na:"bootstrap-css",url:"https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"},{na:"bootstrap",url:"https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"},{na:"lodash",url:"https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"}],ijnjsFileDescript=["SplitStringByRegex","assert","TestTime","rem2Px",{dir:"Path",children:["Path"]},{dir:"BookChapDialog",children:[]}];Libs.s=new Libs,FileCache3rd.s=new FileCache3rd,Ijnjs.Libs=Libs,Ijnjs.FileCache=FileCache,Ijnjs.FileCache3rd=FileCache3rd,Ijnjs.getCacheAsync=getCacheAsync,getJQueryAsync().then(e=>{Libs.s.libs.$=e.$;var t=FileCache3rd.s.loadAsync(thirdPartFileDescription),n=getCacheAsync(ijnjsFileDescript,!0,"ijnjs");t.then(()=>{process3rdFile(),n.then(e=>{processIjnjsFile(e),releaseCacheFromIjnjsAsync(),Ijnjs.st={$:()=>Ijnjs.Libs.s.libs.$,Enumerable:()=>Ijnjs.Libs.s.libs.Enumerable},exportToRootAndDefine()})})})})(this);